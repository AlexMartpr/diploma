# Разработка алгоритма разрешения конфликтов на основе CRDT при совместном редактировании исполняемых блок-схем
Был реализован и внедрён в данный проект алгоритм [TreeDoc](https://inria.hal.science/inria-00445975/document), предназначенный для бесконфликтного совместного редактирования. Модуль с данным алгоритм находится как на клиенте, так и на сервере. На клиенте это папка client/scripts/crdt, а на сервере server/src/lib/crdt.  

Для запуска проекта потребуется фреймворк Node.js и менеджер пакетов Yarn. 

## Установка Node.js и Yarn
### Node.js
Для успешной работы реализованной программы требуется Node.js версии 19.6.0, которую можно скачать по [ссылке](https://nodejs.org/en/blog/release/v19.6.0). 
### Yarn
```bash
npm install --global yarn
```
## Инструкция для запуска проекта
Для того, чтобы запустить проект, необходимы выполнить следующие команды:
1. Перейти в папку сервера
    ```bash
    cd server
    ```
2. Установить все зависимости
    ```bash
    yarn -i
    ```
3. Запустить проект
    ```bash
    yarn start run
    ```
После этого сервер запустить на локальном хосте на порту 8000. 

**В папке server/config находится файл config.json, отвечающий за конфигурацию сервера. В данном json файле есть ключи, по которым содержатся пути. Их нужно изменить по аналогии с тем, как они уже написаны. Это нужно сделать обязательно, иначе сервер не запуститься.**


## Клиентская инструкция
Теперь опишем алгоритм работы с проектом со стороны клиента. Пользователи могут одновременно редактировать и работать вместе именно с заметками, которые есть в редакторе. 

Перейдя в браузере на сервер, мы увидим следующее окно:

![image](https://github.com/AlexMartpr/diploma/assets/68010217/6addcc29-b610-44ba-b9df-113db8d85c9e)

В левой панели отображаются доступные схемы. Если их нет, то можно нажать на кнопку "Create new Scheme", создастся новая схема и отобразится слева. Если после нажатия на кнопку страница просто продолажет грузится и ничего не появляется в левой панели, то нужно перезагрузить страницу и слева отобразится созданная схема.

Нажава на схему, мы попадаем на следующую страницу:

![image](https://github.com/AlexMartpr/diploma/assets/68010217/73f80ebb-8078-4160-97d5-51b15dd752ca)

Теперь мы находимся внутри созданной схемы, на которой можем создавать блоки. Внутри них уже сможем создавать заметки, которые поддерживают совместное редактирование.
Чтобы создать блок, нужно нажать правой кнопкой мыши на сетчатую область. Появится список, в котором нужно выбрать "add block". После этого откроется окно с редактором блока:

![image](https://github.com/AlexMartpr/diploma/assets/68010217/917bcaea-7dcc-4410-b3c6-4ef0403b13d4)

Можно произвольно заполнить поля "Block Name" и "Description", оставшееся поле не трогаем. После нажимаем кнопку "Save". На нашем экране появится созданный блок. Теперь нам нужно перейти в него. Для этого нажмём на zoom в нижнем правом углу созданного блока. 
Оказавшись внутри блока, мы можем создавать заметки. Для этого необходимо вновь нажать правой кнопкой мыши на сетчатую область, появится список и выберем "Add note". 
На экране появится редактируемое поле, внутри которого можно набирать текст. Выглядит это следующим образом:

![image](https://github.com/AlexMartpr/diploma/assets/68010217/ba7aa5f9-12cf-4b69-b0d9-63a4b9b3f635)

Данные заметки можно одновременно и бесконфликтно редактировать в режиме реального времени. Конфликты разрешаются благодаря реализованному алгоритму TreeDoc.

## Технические особенности
1. Алгоритм TreeDoc позволяет нам разрешать конфликты, когда, например, пользователи добавляют символ в одно и то же место в тексте. Причём это происходит автоматически и пользователи не принимают никаого участия в разрешении данного конфликта. 
2. Поддерживается редактирование в оффлайне. То есть, пользователь, потеряв соединение с сервером, всё равно может редактировать заметку. Его операции сохраняются и отправляются на сервер после восстановления соединения. При этом сам пользователь тоже получит те операции пользователей, о которых он не знал, пока находился в оффлайне. 
3. Неважен порядок, в котором приходят операции. В конечном итоге состояние заметки у всех пользователей будет одинаковым. Так как сам алгоритм основан на расширенном бинарном дереве, то, если придут операции о вставке двух подряд идущих символ в разном порядке, в дереве создастся промежуточный узел, который уже заполнится после получения соответствующей операции.
4. Идентификаторы пользователей сессионные. Если обновить страницу, то будет уже другой идентификатор у пользователя. Другими словами, в этом момент к серверу подключится уже новый пользователь. Если стоит задача в тестировании оффлайн режима, можно отключить сервер, заполнить каким-то содержимым заметку, а затем вновь включить сервер и проверить, что остальным пользователям всё пришло и нам соответсвенно тоже пришли операции, которые мы не видели. Главное, не обновлять во время всех действий страницу того пользователя, который был в оффлайне, иначе его операции пропадут. 



